{"componentChunkName":"component---src-templates-blog-post-js","path":"/10-18-2019/","webpackCompilationHash":"","result":{"data":{"site":{"siteMetadata":{"title":"Web Dev Tutorials","author":"Shehan Atuk "}},"markdownRemark":{"id":"88f26ead-0656-560b-a2ec-176aafc5bcdd","excerpt":"How many times have you used a password reset feature because you forgot your password to some website? Password reset forms are a very useful feature in today…","html":"<p>How many times have you used a password reset feature because you forgot your password to some website? Password reset forms are a very useful feature in today’s internet, because most websites require some sort of user authentication. That is why we will go over how to implement a password reset form for a Ruby On Rails application in this post. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/007ebc20e5c5c01ba78195fbb4f066a0/e60a7/img1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.11608222490931%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABgElEQVQoz32R224aMRCG92H7XH2AKlyQu2wEQggpkE0qktANmyXG68PaHp82bVVEaCHDbg69yq/ReDSjb+TfTgCcEIpSLqXmrBa8llLRijLGOGOCcymE0RoAzJuw9NY6axMuJFlTQipCKJJGO61Aa6OUxrED0Aqb2rZ0twFrHGFOZpdZv98/P09PT/vXV9/LktznyzzPy7JEZiXtNYE5tQsebnkohAfc0MmYZDqdTSaTGON4PM4us1VJ8uXjssR7VDhmCpZUPgpYK7dWninXYu0tDCQXF9PRaCSlHA6Hs1lWkLqk9ZorfASt9e9fP3fbze55+2/3vP+722z+oKMj2CqZ39yk6dlgMEjTdHH3I/gnb52zgJ6O9pyLsQkhduG9fyePsAb7ZgGMtvhgiOj/pD702vmAAbzCBdYF3wQfu/CfShpHa1sblzw8rHq9k6IoDofDfr8/fKpu/jVrvvT0t3mT4BdWTBhwTXxCezEcI6C/GNsU2yJ0RxektgsKVW1fALsFGo1UzX3wAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"password reset form\"\n        title=\"password reset form\"\n        src=\"/static/007ebc20e5c5c01ba78195fbb4f066a0/b9e4f/img1.png\"\n        srcset=\"/static/007ebc20e5c5c01ba78195fbb4f066a0/cf440/img1.png 148w,\n/static/007ebc20e5c5c01ba78195fbb4f066a0/d2d38/img1.png 295w,\n/static/007ebc20e5c5c01ba78195fbb4f066a0/b9e4f/img1.png 590w,\n/static/007ebc20e5c5c01ba78195fbb4f066a0/e60a7/img1.png 827w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p align=\"center\">Figure 1: Example of a password reset form.</p>\n<h3>What You Will Need</h3>\n<p>Before starting make sure you have a scaffolded Rails application. I will use the Article scaffold for this post. Also we will need an UserMailer action mailer, CreateUserTable migration, User model, password reset controller and some view files. So without further ado, let’s get started!</p>\n<h3>Setup</h3>\n<p>First let’s create our models and migrations. We will need to create the user table using a migration as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">    create_table :users do |t|\n        t.string :username,    null: false, default: &quot;&quot;\n        t.string :email,       null: false, default: &quot;&quot;\n        t.string :password,    null: false, default: &quot;&quot;\n        t.string :p_salt\n        t.string :fullName\n        t.text :bio \n        t.string :password_reset_token\n        t.datetime :password_reset_sent_at\n        t.timestamps\n    end </code></pre></div>\n<p>We will need one models: Users</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># user.rb \nclass User &lt; ApplicationRecord\n    before_create { generate_token(:auth_token) }\n\n    def send_password_reset \n        generate_token(:password_reset_token)\n        self.password_reset_sent_at = Time.zone.now \n        save!\n        UserMailer.password_reset(self).deliver \n    end \n\n    def generate_token(column)\n        begin \n            self[column] = SecureRandom.urlsafe_base64\n        end while User.exists?(column =&gt; self[column])\n    end </code></pre></div>\n<p>The <code class=\"language-text\">before_create</code> method calls the <code class=\"language-text\">generate_token</code> method before creating a new user, The <code class=\"language-text\">password_reset_token</code> method uses an action mailer to email the user the reset link, and the <code class=\"language-text\">generate_token</code> method generates a unique authentication token for each user record in the database. </p>\n<p>Before we forget lets define our routes in the <code class=\"language-text\">config/routes.rb</code> file as such:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Rails.application.routes.draw do\n  root &#39;articles#index&#39;\n  resources :users\n  resources :password_resets\nend</code></pre></div>\n<p>You can set the link to navigate to the password reset form by including </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;%= link_to &quot;Forgot Password?&quot;, new_password_reset_path, :id =&gt; &quot;password_reset_link&quot; %&gt;</code></pre></div>\n<p>where you think is appropriate. I will include this link in the root url for now.</p>\n<p>Now let’s create our password reset controller by running:<code class=\"language-text\">rails generate controller PasswordResets</code>. Remember to always pluralize controller names and file names as this is Rails convention. Now navigate to <code class=\"language-text\">app/controllers/password_resets_controller.rb</code> and adding the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># password_resets_controller.rb\n    def new\n    end \n\n    def create \n        user = User.find_by_email(params[:email])\n        if user\n            user.send_password_reset  \n        else\n            return redirect_to new_password_reset_path, \n            :notice =&gt; &quot;Email Not Found! Please Enter A Valid Email&quot;\n        end \n        return redirect_to root_url, :notice =&gt; &quot;Email Sent \n        With Password Reset Instructions&quot;\n    end\n\n    def edit\n        @user = User.find_by_password_reset_token!(params[:id])\n        respond_to do |format|\n            format.html { render &quot;edit&quot; }\n            format.js { render &quot;edit&quot; }\n        end \n    end \n\n    def update\n        @user = User.find_by_password_reset_token!(params[:id])\n        if @user.password_reset_sent_at &lt; 2.hours.ago \n            redirect_to root_url, :notice =&gt; &quot;Password Reset Has Been Expired&quot;\n            respond_to do |format|\n                format.js { render &quot;edit&quot; }\n                format.json { render json: {status: false, \n                message: &quot;Password Reset Token Has Been Expired. \n                Please Restart The Reset Process.&quot; } }\n            end \n        elsif @user.update(:password =&gt; params[:password])\n            respond_to do |format|\n                format.js { render &quot;edit&quot;, flash[:notice] =&gt; &quot;Password\n                 Has Been Reset!&quot; }\n                format.json { render json: {status: true, \n                message: &quot;Password Has Been Reset!&quot; } }\n            end\n        else \n            respond_to do |format|\n                format.js { render &quot;edit&quot; }\n                format.json { render json: {status: false,\n                 message: &quot;Password Failed To Update!&quot; } }\n            end\n        end \n    end </code></pre></div>\n<p>The new action renders the initial form where the user enters their email address. Then the create action uses the action mailer to send an email containing a password reset link to the user’s email address and finishes off by redirecting to the root url. The edit action, which is triggered when the user navigates to the link provided in the email, renders the form where the user enters their new password, then upon submission the update action updates the user’s password stored in the database. </p>\n<p>On to the views! In the <code class=\"language-text\">app/views/password_resets</code> folder create three files:<code class=\"language-text\">new.html.erb</code>, <code class=\"language-text\">edit.html.erb</code>, and <code class=\"language-text\">edit.js.erb</code>. The content for each file is shown below:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># new.html.erb\n&lt;%= form_with(url: password_resets_path) do |form| %&gt;\n\n&lt;%= form.label(:email, &quot;Enter The Email Address Associated With Your Account: &quot;) %&gt;\n    &lt;div id=&quot;send_reset_email_errors&quot; &gt;\n        &lt;% if flash[:notice] %&gt;\n            &lt;p class=&quot;error&quot;&gt;&lt;%= flash[:notice] %&gt;&lt;/p&gt;\n        &lt;% end %&gt;\n    &lt;/div&gt;\n&lt;%= form.text_field(:email) %&gt;    \n&lt;/br&gt;\n&lt;%= form.submit(&quot;Reset Password&quot;, :id =&gt; &quot;reset_password_submit&quot;) %&gt;\n\n&lt;% end %&gt;</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># edit.html.erb\n&lt;%= form_with(model: @user, url: password_reset_path(params[:id]),\n method: :put, :remote =&gt; true) do |form| %&gt;\n    &lt;div id=&quot;password_reset_errors&quot;&gt;\n        &lt;% if @user.errors.any? %&gt;\n            &lt;% @user.errors.has_messages.each do |error| %&gt;\n                &lt;p class=&quot;error&quot;&gt;&lt;%= error %&gt;&lt;/p&gt;\n            &lt;% end %&gt;\n        &lt;% end %&gt;\n    &lt;/div&gt;\n&lt;%= form.label(:password, &quot;Enter New Password: &quot;) %&gt;\n&lt;%= form.password_field(:password) %&gt;\n&lt;/br&gt;\n\n&lt;%= form.label(:confirm_password, &quot;Confirm New Password: &quot;) %&gt;\n&lt;%= form.password_field(:confirm_password) %&gt;\n\n&lt;%= form.hidden_field(:password_reset_token) %&gt;\n&lt;%= form.submit &quot;Update Password&quot; %&gt;\n\n&lt;% end %&gt;</code></pre></div>\n<p>and</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># edit.js.erb\n$(&quot;#password_reset_errors&quot;).html(&quot;&quot;);\nif($(&quot;#user_password&quot;).val() === &quot;&quot; || $(&quot;#user_confirm_password&quot;).val() === &quot;&quot; ){\n    $(&quot;#password_reset_errors&quot;).append(&quot;&lt;p class=&#39;error&#39;&gt;Password \n    Fields Cannot Be Empty&lt;/p&gt;&quot;);\n}\nelse if($(&quot;#user_password&quot;).val() === $(&quot;#user_confirm_password&quot;).val()){\n    $.ajax({\n        url: &quot;/password_resets/&quot; + $(&quot;#user_password_reset_token&quot;).val(),\n        method: &quot;PUT&quot;,\n        dataType: &quot;json&quot;,\n        data: {\n            password: $(&quot;#user_password&quot;).val(),\n            authenticity_token: window._token\n        },\n        success: function(data){\n            if(data.status){\n                alert(&quot;Password Has Been Reset!&quot;);\n                window.location.href = &quot;/&quot;;\n            }\n        }\n    });\n}\nelse{\n    $(&quot;#password_reset_errors&quot;).append(&quot;&lt;p class=&#39;error&#39;&gt;Passwords Do Not Match&lt;/p&gt;&quot;);\n}</code></pre></div>\n<p>The HTML files are the forms to be rendered and the JS file handles form validations and remote submission via AJAX call. </p>\n<p>Then we will need an action mailer, generate one by running: <code class=\"language-text\">rails generate mailer UserMailer</code>. Navigate to <code class=\"language-text\">app/mailers/user_mailer.rb</code> and add the following method: </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">class UserMailer &lt; ApplicationMailer\n    default from: &quot;#{ENV[&quot;YOUR_DEFAULT_EMAIL&quot;]}&quot;\n    \n    def password_reset(user)\n        @user = user \n        mail :to =&gt; user.email, :subject =&gt; &quot;Password Reset&quot;\n    end \nend</code></pre></div>\n<p>I recommend you use ENV variables to sent your email credentials as this is the best option to keep your credentials safe. Set the <code class=\"language-text\">default from:</code> field to the email you will send emails from. The <code class=\"language-text\">password_reset</code> method handles email submission. </p>\n<p>After this, we will need to make the file to be rendered as the email body. Following Rails convention we will call this file <code class=\"language-text\">password_reset.text.erb</code> and place it in the <code class=\"language-text\">app/views/user_mailer</code> folder. Add something along the lines of this to it:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">To reset your password click the link below:\n\n&lt;%= edit_password_reset_url(@user.password_reset_token) %&gt;\n\nIf you did not request to change your password just \nignore this email and your password will stay the same.</code></pre></div>\n<p>The <code class=\"language-text\">password_reset</code> method will automatically render this file for the email body without explicit definition. </p>\n<p>Finishing off the action mailer, we will have to define some email configurations in the <code class=\"language-text\">config/environment/development.rb</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"> ActionMailer::Base.delivery_method = :smtp\n\n  ActionMailer::Base.smtp_settings = {\n  :address              =&gt; &quot;#{ENV[&quot;YOUR_EMAIL_PROVIDER_ADDRESS&quot;]}&quot;, # eg:&quot;smtp.gmail.com&quot;\n  :port                 =&gt; &quot;587&quot;,\n  :domain               =&gt; &quot;#{ENV[&quot;YOUR_EMAIL_PROVIDER&quot;]}&quot;,\n  :user_name            =&gt; &quot;#{ENV[&quot;GMAIL_USERNAME&quot;]}&quot;,\n  :password             =&gt; &quot;#{ENV[&quot;GMAIL_PASSWORD&quot;]}&quot;,\n  :authentication       =&gt; &quot;plain&quot;,\n  }</code></pre></div>\n<p>This code snippet tells Rails how to send emails. Make sure to set the appropriate ENV variables for your corresponding email provider, username and password as without these the action mailer cannot send any emails. </p>\n<h3>Testing</h3>\n<p>Now with the necessary files and code setup, test your application by running: <code class=\"language-text\">rails server</code>, navigate to the password reset form by clicking the ‘Forgot Password?’ link and enter a test email. Your email should arrive in your inbox in about 2 minutes if everything is configured correctly. Now click the password reset link, which should redirect you to the form where you enter your new password. Submit that form, logout and log back in with your new password.</p>\n<h3>Closing Notes</h3>\n<p>Assuming everything went as expected, congragulations! You have setup up your own password reset form. If not, reach out to me on my social links listed below or email me your questions at shehanatuk@gmail.com. </p>\n<p>Well that’s all for today, I hope you found this review helpful. I would greatly appreciate if you could check out my <a href=\"https://www.youtube.com/channel/UCtxed_NljgtAXrQMMdLvhrQ?\">Youtube channel</a>, follow me on <a href=\"https://twitter.com/Shehan_Atuk\">Twitter</a>, <a href=\"https://www.linkedin.com/in/shehan-a-780622126/\">LinkedIn</a>, <a href=\"https://github.com/ShehanAT\">Github</a> and <a href=\"https://www.instagram.com/shehanthewebdev/\">Instagram</a>.</p>","frontmatter":{"title":"Password Reset Form In Ruby On Rails","date":"October 18, 2019","description":"How to setup a password reset form in Ruby On Rails"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/10-18-2019/","previous":{"fields":{"slug":"/10-15-2019/"},"frontmatter":{"title":"Action Mailers in Ruby On Rails"}},"next":{"fields":{"slug":"/10-22-2019/"},"frontmatter":{"title":"Form Submission in Ruby On Rails"}}}}}
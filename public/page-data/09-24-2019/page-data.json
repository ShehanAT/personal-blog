{"componentChunkName":"component---src-templates-blog-post-js","path":"/09-24-2019/","webpackCompilationHash":"","result":{"data":{"site":{"siteMetadata":{"title":"Web Dev Tutorials","author":"Shehan Atuk "}},"markdownRemark":{"id":"533ce14f-0024-57b7-bb92-0fb563c0d2b0","excerpt":"Capybara is a powerful testing framework for Ruby on Rails applications. This post will explain how to write basic integration tests using Capybara. So let’s…","html":"<p>Capybara is a powerful testing framework for Ruby on Rails applications. This post will explain how to write basic integration tests using Capybara. So let’s get right to it! </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/43e153b3898d5a477ead64dc1d770fd4/61215/img1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.30779054916987%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAWlrhlWccF//xAAZEAEBAQEBAQAAAAAAAAAAAAACAQASAxH/2gAIAQEAAQUCcpyc+Qx5zoXzON5n/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERUf/aAAgBAgEBPwFPSn//xAAaEAACAgMAAAAAAAAAAAAAAAAAEQEQMmGR/9oACAEBAAY/AtU4EYz0R//EABsQAAIDAAMAAAAAAAAAAAAAAAABESExQVFh/9oACAEBAAE/IbGdFT0IMvBzo6LptSRQ4af/2gAMAwEAAgADAAAAEIQP/8QAFhEAAwAAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EIkU/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAgEBPxAAwSt5f//EABsQAQADAQEBAQAAAAAAAAAAAAEAESExUWHh/9oACAEBAAE/EDrkVBOvxgka4a9YLwOY4xADRf5DneTQQTRjcPdn/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Testing diagram\"\n        title=\"Testing diagram\"\n        src=\"/static/43e153b3898d5a477ead64dc1d770fd4/c739e/img1.jpg\"\n        srcset=\"/static/43e153b3898d5a477ead64dc1d770fd4/8ee9c/img1.jpg 148w,\n/static/43e153b3898d5a477ead64dc1d770fd4/ebbe7/img1.jpg 295w,\n/static/43e153b3898d5a477ead64dc1d770fd4/c739e/img1.jpg 590w,\n/static/43e153b3898d5a477ead64dc1d770fd4/61215/img1.jpg 783w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p align=\"center\">Side note: Capybaras are the largest living rodents in the world.</p>\n<h3>Check for presence of elements in page</h3>\n<p>Building on the previous article application, let’s say we have a login form and want to check if the clicking of the <code class=\"language-text\">Login</code> button redirects to a different page. We can test this using Capybara. I will show what to do first then explain my steps later as this keeps these posts nice and to the point. </p>\n<p>Let’s create a controller file: <code class=\"language-text\">app/session/session_controller.rb</code> which will hold the login action needed to authenticate users. I will skip the implementation of the User model and the login functionality because it is beyond the scope of this post. The controller file will contain three actions <code class=\"language-text\">new</code>, <code class=\"language-text\">create</code> and <code class=\"language-text\">welcome</code>, which are shown below:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">def new \nend \n\ndef create\n    @userToRender = User.authenticate(params[:username], params[:password])\n    respond_to do |format|\n        if @userToRender\n            session[:username] = @userToRender.username\n            session[:user_id] = @userToRender.id\n            format.html { redirect_to &quot;/welcome&quot; }\n        else \n            format.html { render &quot;new&quot; }\n        end \n    end  \nend\n\ndef welcome\nend </code></pre></div>\n<p>Upon calling the create action the user is redirected to the route: <code class=\"language-text\">/welcome</code>. Now let’s add three routes to the <code class=\"language-text\">config/routes.rb</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  get &quot;new&quot;, to: &quot;session#new&quot;\n  post &quot;new&quot;, to: &quot;session#create&quot;\n  get &quot;welcome&quot;, to: &quot;session#welcome&quot;</code></pre></div>\n<p>We will also need two view files:<code class=\"language-text\">app/views/session/new.html.erb</code> and <code class=\"language-text\">app/views/session/welcome.html.erb</code>.  Let’s add a login form to the <code class=\"language-text\">new.html.erb</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;%= form_with( method: &quot;post&quot;, id: &quot;login_form&quot;) do %&gt;\n   \n    &lt;div id=&quot;alert_message&quot;&gt; \n    &lt;/div&gt;\n    &lt;%= label_tag(:username, &quot;Username:&quot;) %&gt;\n    &lt;%= text_field_tag(:username)  %&gt;\n    \n    &lt;%= label_tag(:password, &quot;Password:&quot;) %&gt;\n    &lt;%= password_field_tag(:password)  %&gt;\n    \n    &lt;%= submit_tag &quot;Login&quot;, data: { &quot;disable-with&quot;: &quot;Loading...&quot; }, remote: true %&gt;\n&lt;% end %&gt;</code></pre></div>\n<p>and a simple welcome message to the <code class=\"language-text\">welcome.html.erb</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;h1&gt;Welcome to My Application!&lt;/&gt;</code></pre></div>\n<p>Now with the login functionality setup up let’s write the integration test to test for a redirection on button click. In the <code class=\"language-text\">app/test/controllers/session_controller_test.rb</code> file add this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">test &quot;should redirect from /new to /welcome on login button click&quot; do \n    Capybara.visit(&quot;/new&quot;)\n    Capybara.fill_in &#39;username&#39;, :with =&gt; &#39;admin&#39;\n    Capybara.fill_in &#39;password&#39;, :with =&gt; &#39;admin&#39;\n    old_path = Capybara.page.current_path\n    Capybara.page.first(&quot;input[type=&#39;submit&#39;]&quot;).click\n    sleep 0.1\n    new_path = Capybara.page.current_path\n    assert_not_equal(old_path, new_path)\nend </code></pre></div>\n<p>Run this test file specifically with <code class=\"language-text\">rails test test/controllers/session_controller_test.rb</code> and you should see </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">3 runs, 3 assertions, 0 failures, 0 errors, 0 skips</code></pre></div>\n<p>So with our test passing let’s go over what we just did. First we created the login functionality, that part is pretty self explanatory. Then in the writing of the test we declared <code class=\"language-text\">Capybara.visit(&#39;/new&#39;)</code> which indicates to Capybara to visit the url <code class=\"language-text\">localhost:3000/new</code>. Now the <code class=\"language-text\">new.html.erb</code> file, containing the login form, will be rendered by the browser. The <code class=\"language-text\">Capybara.fill_in</code> method does exactly what it sounds like: it fills in the input for a specified element on the page. Note that filling in the form fields at this point won’t actually validate the user as the purpose of this example is to demostrate the functionality of Capybara and not login authentication. Before we click the submit button we have to save the current path of the url so that we have a reference to compare to if the redirection actually works, which is done through the variable <code class=\"language-text\">old_path</code>. By the way, <code class=\"language-text\">Capybara.page.current_path</code> gets the path of the current url. Now, the <code class=\"language-text\">Capybara.page.first(&quot;input[type=&#39;submit&#39;]&quot;).click</code> line tells Capybara to find the first element of type <code class=\"language-text\">input[type=&#39;submit&#39;]</code> and click it. This should trigger the redirection event to occur. In order to check for this we first need to tell Capybara to pause its execution for 0.1 seconds. This is to ensure the application has time to process the click event and respond to it before we check for the url path again. Then the path of the new url is saved to the <code class=\"language-text\">new_path</code> variable and is compared with <code class=\"language-text\">old_path</code> through the use of <code class=\"language-text\">assert_not_equal</code>. Since the test passed, we know that <code class=\"language-text\">new_path</code> did not equal <code class=\"language-text\">old_path</code> meaning the redirection was successful.  </p>\n<p>I will stop here for the sake of brevity but I encourage you to look further into Capybara. It’s documentation can be found <a href=\"https://rubydoc.info/github/teamcapybara/capybara/master\">here</a>. </p>\n<p>Well that’s all for today, I hope you found this review helpful. I would greatly appreciate if you could check out my <a href=\"https://www.youtube.com/channel/UCtxed_NljgtAXrQMMdLvhrQ?\">Youtube channel</a>, follow me on <a href=\"https://twitter.com/Shehan_Atuk\">Twitter</a>, <a href=\"https://www.linkedin.com/in/shehan-a-780622126/\">LinkedIn</a>, <a href=\"https://github.com/ShehanAT\">Github</a> and <a href=\"https://www.instagram.com/shehanthewebdev/\">Instagram</a>.</p>","frontmatter":{"title":"Basic Integration Testing For Ruby On Rails Apps Part 2","date":"September 24, 2019","description":"Implementing basic integration tests using Capybara."}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/09-24-2019/","previous":{"fields":{"slug":"/09-20-2019/"},"frontmatter":{"title":"Basic Integration Testing For Ruby On Rails Apps Part 1"}},"next":null}}}